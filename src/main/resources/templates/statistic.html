<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Statistic</title>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="/webjars/materializecss/1.0.0/css/materialize.min.css"
          media="screen,projection"/>

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <!--JavaScript at end of body for optimized loading-->
    <script type="text/javascript" src="/webjars/materializecss/1.0.0/js/materialize.min.js"></script>
    <script src="/webjars/chartjs/2.7.3/Chart.js"></script>
</head>
<body>
<header>
    <nav>
        <div class="nav-wrapper">
            <div class="col s12">
                <a th:href="@{/smartphone}" class="breadcrumb">Smartphones</a>
                <a class="breadcrumb" th:text="|${statistic.brand} ${statistic.model}|"></a>
            </div>
        </div>
    </nav>
</header>
<main>
    <div class="row">
        <div>
            <h3 class="center-align" th:text="|${statistic.brand} ${statistic.model}| + ' statistics'"></h3>
        </div>
        <div class="col s6">
            <form action="#" th:action="@{/smartphone}" th:object="${statistic}" th:method="put">
                <input th:type="hidden" th:field="${statistic.id}"/>
                <div class="row">
                    <div class="input-field col s4 offset-s4">
                        <label th:for="rating">Rating</label>
                        <input th:id="rating" th:field="${statistic.rating}" th:value="${statistic.rating}" type="number" step="0.01" class="validate" required="required" min="0.0" max="5.0">
                        <span class="helper-text" data-error="wrong" data-success="right"/>
                    </div>
                </div>
                <div class="row">

                    <div class="col s4" th:each="entry : ${statistic.coefficients}">
                        <div class="col s12">
                            <!--This is an inline input field:-->
                            <div class="input-field inline">
                                <label th:for="${entry.key}" th:text="${entry.key}">example</label>
                                <input th:id="${entry.key}" th:field="*{coefficients[__${entry.key}__]}" th:value="${entry.value}" type="number" step="0.01" class="validate" required="required"/>
                                <span class="helper-text" data-error="wrong" data-success="right"/>
                            </div>
                        </div>
                    </div>
                </div>
                <button class="fixed-action-btn btn-floating btn-large cyan" type="submit" name="action">
                    <i class="material-icons">save</i>
                </button>
            </form>
        </div>
        <div class="col s6">
            <canvas id="myChart"></canvas>
        </div>
    </div>
</main>
<!--<footer>-->
<!--<div th:replace="fragments/footer :: footer"/>-->
<!--</footer>-->

<!--@formatter:off-->

<script th:inline="javascript">
    /*<![CDATA[*/
    var myChart = null;
    document.addEventListener('DOMContentLoaded', function () {
        var sales = /*[[${statistic.sales}]]*/;

        var yearMonths = Object.keys(sales);
        var quantities = Object.values(sales);

        let expectedQuantities = quantities.map(quantity => quantity.expectedQuantity);
        let customCoefficientsQuantities = quantities.map(quantity => quantity.customCoefficientQuantity);
        let movingAverageQuantities = quantities.map(quantity => quantity.movingAverageQuantity);

        var ctx = document.getElementById("myChart").getContext('2d');

        var expectedDataset = {
            label: 'Expected statistic',
            data: expectedQuantities,
            borderColor: 'red',
            backgroundColor: 'transparent',
            borderWidth: 1
        };

        var customCoefficientsDataset = {
            label: 'Custom coefficients statistic',
            data: customCoefficientsQuantities,
            borderColor: 'green',
            backgroundColor: 'transparent',
            borderWidth: 1
        };

        var movingAverageDataset = {
            label: 'Moving average statistic',
            data: movingAverageQuantities,
            borderColor: 'blue',
            backgroundColor: 'transparent',
            borderWidth: 1
        };

        var options = {
            // scales: {
            //     yAxes: [{
            //         ticks: {
            //             // min: 0,
            //             // max: 500
            //         }
            //     }]
            // }
        };
        if (myChart == null) {
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: yearMonths,
                    datasets: [expectedDataset, customCoefficientsDataset, movingAverageDataset]
                },
                options: options
            });
        } else {
            myChart.data.labels = yearMonths;
            myChart.data.datasets = [expectedDataset, customCoefficientsDataset];
            myChart.update();
        }

    });

    /*]]>*/
</script>
<!--@formatter:on-->

</body>
</html>



